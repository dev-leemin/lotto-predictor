generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Account {
  id                String  @id
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  User              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model CoverLetter {
  id                  String                @id
  userId              String
  title               String
  status              DocumentStatus        @default(DRAFT)
  targetRole          String?
  targetCompany       String?
  jobPostingUrl       String?
  jobAnalysis         Json?
  overallFeedback     String?
  overallScore        Int?
  createdAt           DateTime              @default(now())
  updatedAt           DateTime
  User                User                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  CoverLetterQuestion CoverLetterQuestion[]

  @@index([userId, createdAt])
}

model CoverLetterQuestion {
  id              String      @id
  coverLetterId   String
  order           Int
  question        String
  maxLength       Int?
  answer          String?
  generatedAnswer String?
  feedback        String?
  score           Int?
  keywords        String[]
  improvements    String[]
  starAnalysis    Json?
  createdAt       DateTime    @default(now())
  updatedAt       DateTime
  CoverLetter     CoverLetter @relation(fields: [coverLetterId], references: [id], onDelete: Cascade)
}

model Interview {
  id                String              @id
  userId            String
  jobRole           String
  company           String?
  difficulty        Difficulty          @default(MEDIUM)
  type              InterviewType       @default(TECHNICAL)
  status            InterviewStatus     @default(IN_PROGRESS)
  score             Int?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime
  User              User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  InterviewQuestion InterviewQuestion[]
}

model InterviewQuestion {
  id               String    @id
  interviewId      String
  order            Int
  question         String
  answer           String?
  feedback         String?
  score            Int?
  strengths        String[]
  improvements     String[]
  followUpQuestion String?
  followUpAnswer   String?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime
  Interview        Interview @relation(fields: [interviewId], references: [id], onDelete: Cascade)
}

model JobPosting {
  id               String   @id
  userId           String
  url              String
  company          String
  position         String
  requirements     String[]
  preferredSkills  String[]
  responsibilities String[]
  benefits         String[]
  techKeywords     String[]
  softKeywords     String[]
  rawContent       String?
  createdAt        DateTime @default(now())

  @@index([userId, createdAt])
}

model Portfolio {
  id               String   @id
  userId           String
  githubUrl        String?
  portfolioUrl     String?
  overallScore     Int?
  codeQuality      Int?
  projectStructure Int?
  documentation    Int?
  strengths        String[]
  improvements     String[]
  interviewTips    String[]
  detailedFeedback String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime
  User             User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Resume {
  id               String         @id
  userId           String
  title            String
  targetRole       String?
  targetCompany    String?
  feedback         String?
  createdAt        DateTime       @default(now())
  updatedAt        DateTime
  awards           Json?
  certifications   Json?
  education        Json?
  experiences      Json?
  feedbackDetails  Json?
  feedbackScore    Int?
  generatedContent String?
  jobPostingUrl    String?
  languages        Json?
  personalInfo     Json?
  projects         Json?
  skills           Json?
  status           DocumentStatus @default(DRAFT)
  summary          String?
  template         ResumeTemplate @default(MODERN)
  User             User           @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, createdAt])
}

model Roadmap {
  id             String        @id
  userId         String
  title          String
  targetRole     String
  currentLevel   String?
  targetLevel    String?
  currentSkills  String[]
  requiredSkills String[]
  gapSkills      String[]
  estimatedWeeks Int?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime
  User           User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  RoadmapItem    RoadmapItem[]
}

model RoadmapItem {
  id          String            @id
  roadmapId   String
  week        Int
  title       String
  description String?
  skills      String[]
  resources   String[]
  tasks       String[]
  status      RoadmapItemStatus @default(NOT_STARTED)
  createdAt   DateTime          @default(now())
  updatedAt   DateTime
  Roadmap     Roadmap           @relation(fields: [roadmapId], references: [id], onDelete: Cascade)
}

model SelfIntroScript {
  id            String   @id
  userId        String
  title         String
  script        String
  duration      String
  style         String
  charCount     Int
  estimatedTime String
  resumeId      String?
  coverLetterId String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime
  User          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, createdAt])
}

model Session {
  id           String   @id
  sessionToken String   @unique
  userId       String
  expires      DateTime
  User         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model UsageLog {
  id        String   @id
  userId    String
  feature   String
  createdAt DateTime @default(now())

  @@index([userId, feature, createdAt])
}

model User {
  id                  String            @id
  name                String?
  email               String?           @unique
  emailVerified       DateTime?
  image               String?
  createdAt           DateTime          @default(now())
  updatedAt           DateTime
  onboardingCompleted Boolean           @default(false)
  plan                Plan              @default(FREE)
  planExpiresAt       DateTime?
  Account             Account[]
  CoverLetter         CoverLetter[]
  Interview           Interview[]
  Portfolio           Portfolio[]
  Resume              Resume[]
  Roadmap             Roadmap[]
  SelfIntroScript     SelfIntroScript[]
  Session             Session[]
  UserProfile         UserProfile?
}

model UserProfile {
  id              String    @id
  userId          String    @unique
  nickname        String?
  currentRole     String?
  targetRole      String?
  experience      String?
  targetCompanies String[]
  skills          String[]
  targetSkills    String[]
  githubUrl       String?
  linkedinUrl     String?
  portfolioUrl    String?
  jobType         JobType?
  workType        WorkType?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime
  User            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

enum Difficulty {
  EASY
  MEDIUM
  HARD
}

enum DocumentStatus {
  DRAFT
  COMPLETED
  SUBMITTED
}

enum InterviewStatus {
  IN_PROGRESS
  COMPLETED
  REVIEWED
}

enum InterviewType {
  TECHNICAL
  BEHAVIORAL
  EXPERIENCE
  MIXED
}

enum JobType {
  FULL_TIME
  CONTRACT
  INTERNSHIP
  FREELANCE
}

enum Plan {
  FREE
  PRO
  PRO_YEARLY
}

enum ResumeTemplate {
  SIMPLE
  MODERN
  PROFESSIONAL
  CREATIVE
}

enum RoadmapItemStatus {
  NOT_STARTED
  IN_PROGRESS
  COMPLETED
}

enum WorkType {
  REMOTE
  ONSITE
  HYBRID
}

// ========== 로또 예측기 테이블 ==========

// 로또 6/45 당첨 결과
model LottoResult {
  id           Int      @id @default(autoincrement())
  round        Int      @unique
  date         String
  num1         Int
  num2         Int
  num3         Int
  num4         Int
  num5         Int
  num6         Int
  bonus        Int
  firstPrize   BigInt?
  firstWinners Int?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([round])
}

// 연금복권 720+ 당첨 결과
model PensionLotteryResult {
  id         Int      @id @default(autoincrement())
  round      Int      @unique
  date       String
  group1     Int      // 1등 조 (1~5)
  num1_1     Int      // 1등 1번째 자리
  num1_2     Int      // 1등 2번째 자리
  num1_3     Int      // 1등 3번째 자리
  num1_4     Int      // 1등 4번째 자리
  num1_5     Int      // 1등 5번째 자리
  num1_6     Int      // 1등 6번째 자리
  bonusGroup Int?     // 보너스 조
  bonus1     Int?     // 보너스 1번째 자리
  bonus2     Int?     // 보너스 2번째 자리
  bonus3     Int?     // 보너스 3번째 자리
  bonus4     Int?     // 보너스 4번째 자리
  bonus5     Int?     // 보너스 5번째 자리
  bonus6     Int?     // 보너스 6번째 자리
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([round])
}
